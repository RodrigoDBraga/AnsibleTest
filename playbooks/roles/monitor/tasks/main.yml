
#- name: Update and deploy monitoring configuration
#  template:
#    src: otel-collector-config.yaml.j2
#    #dest: "{{ playbook_dir }}/client/configs/otel-collector-config.yaml"
#    dest: "/var/jenkins_home/workspace/Private_github_test/client/configs/otel-collector-config.yaml"


#- name: Restart monitoring service
  #shell: docker-compose -f {{ playbook_dir }}/client/configs/docker-compose-client-monitor.yml up -d
#  shell: docker-compose -f /var/jenkins_home/workspace/Private_github_test/client/configs/docker-compose-client-monitor.yml up -d

#
#- name: Ensure sudo is installed
#  become: yes
#  apt:
#    name: sudo
#    state: present
  


---
- name: Print server IP and name
  debug:
    msg: "Server IP: {{ server_ip }}, Server Name: {{ server_name }}"
  vars:
    server_ip: "{{ server_ip }}"
    server_name: "{{ server_name }}"

- name: Ensure Docker service is running
  service:
    name: docker
    state: started
    enabled: yes

- name: Clone monitoring repository
  git:
    #repo: "https://github.com/iprolepsis-project-eu/monitoring.git"
    repo: "https://github.com/RodrigoDBraga/AnsibleTest"
    dest: /opt/monitoring

- name: Create environment file for Docker Compose
  copy:
    content: |
      SERVER_IP={{ server_ip }}
      SERVER_NAME={{ server_name }}
    dest: /opt/monitoring/.env
    owner: root
    group: root
    mode: '0644'

- name: Start monitoring services with Docker Compose
  command: docker-compose up -d
  args:
    chdir: /opt/monitoring
